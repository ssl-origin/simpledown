<!-- INCLUDE overall_header.html -->
<!-- INCLUDECSS @mundophpbb_simpledown/acp_simpledown.css -->
<h1>{L_ACP_SIMPLEDOWN_TOOLS}</h1>
<div id="acp_simpledown">
    <!-- GRID PRINCIPAL: 2 COLUNAS PARA MINIATURAS E ÓRFÃOS -->
    <div class="tools-grid">
        <!-- COLUNA 1: GERENCIAMENTO DE MINIATURAS -->
        <fieldset class="tools-column">
            <legend>{L_ACP_SIMPLEDOWN_THUMBNAILS_MANAGEMENT}</legend>
            <p>{L_ACP_SIMPLEDOWN_THUMBNAILS_EXPLAIN_SIMPLE}</p>
            <div class="acp-controls-top">
                <div class="control-item total-item">
                    {L_ACP_SIMPLEDOWN_TOTAL_THUMBS}: <strong>{TOTAL_THUMBS}</strong>
                </div>
            </div>
            <!-- IF S_HAS_THUMBS -->
            <dl>
                <dt><label for="thumb_select">{L_ACP_SIMPLEDOWN_AVAILABLE_THUMBS}:</label></dt>
                <dd>
                    <select id="thumb_select" size="1">
                        <option value="">{L_ACP_SIMPLEDOWN_SELECT_ONE_THUMB}</option>
                        <!-- BEGIN thumbs -->
                        <option value="{thumbs.U_DELETE}" data-preview="{thumbs.PREVIEW_URL}">
                            {thumbs.FILENAME} ({thumbs.SIZE})
                        </option>
                        <!-- END thumbs -->
                    </select>
                </dd>
            </dl>
            <div id="thumb-preview-container" style="display:none; margin-top:25px;">
                <div style="text-align:center; padding:20px; background:var(--light-bg); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);">
                    <p style="margin-bottom:15px; font-weight:600;">
                        <strong>{L_ACP_SIMPLEDOWN_PREVIEW_TITLE}</strong>
                    </p>
                    <img id="thumb-preview-img" src="" alt="{L_ACP_SIMPLEDOWN_THUMB_PREVIEW_ALT}" style="max-width:350px; max-height:350px; border-radius:8px; box-shadow:var(--shadow);" />
                    <div style="margin-top:20px;">
                        <a id="delete-thumb-btn" href="javascript:void(0);" class="button2 danger" style="display:none;">
                            <i class="icon fa-trash fa-fw"></i> {L_ACP_SIMPLEDOWN_DELETE_THIS_THUMB}
                        </a>
                    </div>
                </div>
            </div>
            <!-- ELSE -->
            <p style="text-align:center; color:var(--text-light); font-style:italic; padding:20px;">
                {L_ACP_SIMPLEDOWN_NO_THUMBS_FOUND}
            </p>
            <!-- ENDIF -->
        </fieldset>
        <!-- COLUNA 2: ARQUIVOS ÓRFÃOS -->
        <fieldset class="tools-column">
            <legend>{L_ACP_SIMPLEDOWN_ORPHAN_FILES_MANAGEMENT}</legend>
            <p>{L_ACP_SIMPLEDOWN_ORPHAN_FILES_EXPLAIN}</p>
            <p style="color:var(--danger); font-weight:600;">{L_ACP_SIMPLEDOWN_ORPHAN_WARNING}</p>
            <div class="acp-controls-top">
                <div class="control-item total-item">
                    {L_ACP_SIMPLEDOWN_TOTAL_ORPHAN_FILES}: <strong>{TOTAL_ORPHANS}</strong>
                </div>
            </div>
            <!-- IF S_HAS_ORPHANS -->
            <dl>
                <dt><label for="orphan_select">{L_ACP_SIMPLEDOWN_AVAILABLE_ORPHAN_FILES}:</label></dt>
                <dd>
                    <select id="orphan_select" size="1">
                        <option value="">{L_ACP_SIMPLEDOWN_SELECT_ONE_FILE}</option>
                        <!-- BEGIN orphan_files -->
                        <option value="{orphan_files.U_DELETE}" data-filename="{orphan_files.FILENAME}">
                            {orphan_files.FILENAME} ({orphan_files.SIZE})
                        </option>
                        <!-- END orphan_files -->
                    </select>
                </dd>
            </dl>
            <div id="orphan-preview-container" style="display:none; margin-top:25px;">
                <div style="text-align:center; padding:20px; background:var(--light-bg); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);">
                    <p style="margin-bottom:15px; font-weight:600; color:var(--danger);">
                        <strong>{L_ACP_SIMPLEDOWN_ORPHAN_WARNING}</strong>
                    </p>
                    <p style="margin-bottom:20px; font-family:monospace; word-break:break-all; font-size:1.1em;">
                        <span id="orphan-filename"></span>
                    </p>
                    <div style="margin-top:20px;">
                        <a id="delete-orphan-btn" href="javascript:void(0);" class="button2 danger" style="display:none;">
                            <i class="icon fa-trash fa-fw"></i> {L_ACP_SIMPLEDOWN_DELETE_THIS_FILE}
                        </a>
                    </div>
                </div>
            </div>
            <!-- ELSE -->
            <p style="text-align:center; color:var(--text-light); font-style:italic; padding:20px;">
                {L_ACP_SIMPLEDOWN_NO_ORPHAN_FILES_FOUND}
            </p>
            <!-- ENDIF -->
        </fieldset>
    </div>
    <!-- LINHA DE BAIXO: ARQUIVOS ASSOCIADOS (LARGURA TOTAL) -->
    <fieldset class="tools-full-width">
        <legend>{L_ACP_SIMPLEDOWN_ASSOCIATED_FILES}</legend>
        <p>{L_ACP_SIMPLEDOWN_ASSOCIATED_FILES_EXPLAIN}</p>
        <div class="acp-controls-top">
            <div class="control-item total-item">
                {L_ACP_SIMPLEDOWN_TOTAL_ASSOCIATED}: <strong>{TOTAL_ASSOCIATED}</strong>
            </div>
        </div>
        <!-- IF S_HAS_ASSOCIATED -->
        <table class="table1">
            <thead>
                <tr>
                    <th>{L_ACP_SIMPLEDOWN_DISPLAY_NAME}</th>
                    <th>{L_ACP_SIMPLEDOWN_FILE_NAME}</th>
                    <th>{L_SIZE}</th>
                </tr>
            </thead>
            <tbody>
                <!-- BEGIN associated_files -->
                <tr>
                    <td><strong>{associated_files.DISPLAY_NAME}</strong></td>
                    <td style="font-family:monospace; font-size:0.95em;">
                        <a href="{associated_files.FILE_URL}" target="_blank" rel="noopener">{associated_files.FILENAME}</a>
                    </td>
                    <td style="text-align:center;">{associated_files.SIZE}</td>
                </tr>
                <!-- END associated_files -->
            </tbody>
        </table>
        <!-- ELSE -->
        <p style="text-align:center; color:var(--text-light); font-style:italic; padding:20px;">
            {L_ACP_SIMPLEDOWN_NO_ASSOCIATED_FILES}
        </p>
        <!-- ENDIF -->
    </fieldset>
</div>

<!-- SCRIPT PARA PREVIEW DE MINIATURAS E ÓRFÃOS -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Miniaturas
    const thumbSelect = document.getElementById('thumb_select');
    const thumbContainer = document.getElementById('thumb-preview-container');
    const thumbImg = document.getElementById('thumb-preview-img');
    const deleteThumbBtn = document.getElementById('delete-thumb-btn');

    if (thumbSelect && thumbContainer) {
        thumbSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const previewUrl = selectedOption.dataset.preview || '';
            const deleteUrl = this.value || '';

            if (previewUrl && deleteUrl) {
                thumbImg.src = previewUrl; // já tem cache buster do controller (?t=mtime)
                thumbImg.alt = selectedOption.text.trim();
                deleteThumbBtn.href = deleteUrl;
                deleteThumbBtn.style.display = 'inline-block';
                thumbContainer.style.display = 'block';
            } else {
                thumbContainer.style.display = 'none';
                deleteThumbBtn.style.display = 'none';
            }
        });
    }

    // Arquivos órfãos
    const orphanSelect = document.getElementById('orphan_select');
    const orphanContainer = document.getElementById('orphan-preview-container');
    const orphanFilename = document.getElementById('orphan-filename');
    const deleteOrphanBtn = document.getElementById('delete-orphan-btn');

    if (orphanSelect && orphanContainer) {
        orphanSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const filename = selectedOption.dataset.filename || selectedOption.text.trim();
            const deleteUrl = this.value || '';

            if (filename && deleteUrl) {
                orphanFilename.textContent = filename;
                deleteOrphanBtn.href = deleteUrl;
                deleteOrphanBtn.style.display = 'inline-block';
                orphanContainer.style.display = 'block';
            } else {
                orphanContainer.style.display = 'none';
                deleteOrphanBtn.style.display = 'none';
            }
        });
    }
});
</script>
<!-- INCLUDE overall_footer.html -->
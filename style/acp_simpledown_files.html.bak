<!-- INCLUDE overall_header.html -->
<h1>{L_ACP_SIMPLEDOWN_TITLE} - {L_ACP_SIMPLEDOWN_EXISTING_FILES}</h1>
<form id="acp_simpledown" method="post" action="{U_ACTION}" enctype="multipart/form-data">
    {S_FORM_TOKEN}
    <!-- ======================================== -->
    <!-- MODO EDIÇÃO DE ARQUIVO -->
    <!-- ======================================== -->
    <!-- IF S_EDIT_MODE -->
    <fieldset>
        <legend>{L_ACP_SIMPLEDOWN_EDIT_DESCRIPTION}: <strong>{EDIT_FILE_NAME}</strong></legend>
        <input type="hidden" name="action" value="edit" />
        <input type="hidden" name="id" value="{EDIT_FILE_ID}" />
        <dl>
            <dt><label for="edit_file_name">{L_ACP_SIMPLEDOWN_FILE_NAME}:</label><br />
                <span>{L_ACP_SIMPLEDOWN_FILE_NAME_EXPLAIN}</span>
            </dt>
            <dd><input type="text" id="edit_file_name" name="edit_file_name" value="{EDIT_FILE_NAME}" maxlength="255" size="50" required /></dd>
        </dl>
        <dl>
            <dt><label for="edit_file_desc_short">{L_ACP_SIMPLEDOWN_SHORT_DESCRIPTION}:</label></dt>
            <dd><textarea id="edit_file_desc_short" name="edit_file_desc_short" rows="3" cols="60">{EDIT_FILE_DESC_SHORT}</textarea></dd>
        </dl>
        <!-- TOOLBAR + DESCRIÇÃO COMPLETA COM BBCODE (corrigido) -->
        <dl>
            <dt><label for="edit_file_desc">{L_ACP_SIMPLEDOWN_DESCRIPTION}:</label><br>
                <span>{L_ACP_SIMPLEDOWN_DESCRIPTION_EXPLAIN}</span></dt>
            <dd>
                <div class="bbcode-toolbar">
                    <button type="button" class="bbcode-btn" data-tag="b" title="{L_ACP_SIMPLEDOWN_BBCODE_BOLD}"><strong>B</strong></button>
                    <button type="button" class="bbcode-btn" data-tag="i" title="{L_ACP_SIMPLEDOWN_BBCODE_ITALIC}"><em>I</em></button>
                    <button type="button" class="bbcode-btn" data-tag="u" title="{L_ACP_SIMPLEDOWN_BBCODE_UNDERLINE}"><u>U</u></button>
                    <button type="button" class="bbcode-btn" data-tag="quote" title="{L_ACP_SIMPLEDOWN_BBCODE_QUOTE}">Quote</button>
                    <button type="button" class="bbcode-btn" data-tag="code" title="{L_ACP_SIMPLEDOWN_BBCODE_CODE}">Code</button>
                    <button type="button" class="bbcode-btn" data-tag="url" title="{L_ACP_SIMPLEDOWN_BBCODE_URL}">URL</button>
                    <button type="button" class="bbcode-btn" data-tag="img" title="{L_ACP_SIMPLEDOWN_BBCODE_IMG}">IMG</button>
                    <button type="button" class="bbcode-btn" data-tag="list" title="{L_ACP_SIMPLEDOWN_BBCODE_LIST}">List</button>
                    <label for="color-picker-edit" class="bbcode-btn color-btn" title="{L_ACP_SIMPLEDOWN_BBCODE_COLOR}">
                        <i class="fa-solid fa-palette"></i> {L_ACP_SIMPLEDOWN_BBCODE_COLOR}
                    </label>
                    <input type="color" id="color-picker-edit" style="position:absolute; left:-9999px;">
                    <select class="bbcode-btn size-select" title="{L_ACP_SIMPLEDOWN_BBCODE_SIZE_TITLE}">
                        <option value="" disabled selected>{L_ACP_SIMPLEDOWN_BBCODE_SIZE}</option>
                        <option value="50">{L_ACP_SIMPLEDOWN_BBCODE_SIZE_VERY_SMALL}</option>
                        <option value="85">{L_ACP_SIMPLEDOWN_BBCODE_SIZE_SMALL}</option>
                        <option value="100">{L_ACP_SIMPLEDOWN_BBCODE_SIZE_NORMAL}</option>
                        <option value="150">{L_ACP_SIMPLEDOWN_BBCODE_SIZE_LARGE}</option>
                        <option value="200">{L_ACP_SIMPLEDOWN_BBCODE_SIZE_VERY_LARGE}</option>
                    </select>
                </div>
                <textarea id="edit_file_desc" name="edit_file_desc" rows="12" cols="80" class="inputbox">{EDIT_FILE_DESC}</textarea>
            </dd>
        </dl>
        <dl>
            <dt><label for="edit_file_version">{L_ACP_SIMPLEDOWN_VERSION}:</label><br />
                <span>{L_ACP_SIMPLEDOWN_VERSION_EXPLAIN}</span>
            </dt>
            <dd><input type="text" id="edit_file_version" name="edit_file_version" value="{EDIT_FILE_VERSION}" maxlength="50" size="20" placeholder="ex: 2.1.0" /></dd>
        </dl>
        <dl>
            <dt><label for="edit_category">{L_ACP_SIMPLEDOWN_CATEGORY}:</label></dt>
            <dd>
                <select id="edit_category" name="edit_category">
                    <option value="0">{L_ACP_SIMPLEDOWN_NO_CATEGORY}</option>
                    <!-- BEGIN categories -->
                    <option value="{categories.ID}" {categories.S_SELECTED}>{categories.NAME}</option>
                    <!-- END categories -->
                </select>
            </dd>
        </dl>
        <dl>
            <dt><label>{L_ACP_SIMPLEDOWN_VISIBILITY}:</label><br />
                <span>{L_ACP_SIMPLEDOWN_VISIBILITY_EXPLAIN}</span>
            </dt>
            <dd>
                <label><input type="radio" name="is_private" value="0" <!-- IF not EDIT_FILE_IS_PRIVATE -->checked<!-- ENDIF --> /> {L_ACP_SIMPLEDOWN_PUBLIC}</label>&nbsp;&nbsp;&nbsp;
                <label><input type="radio" name="is_private" value="1" <!-- IF EDIT_FILE_IS_PRIVATE -->checked<!-- ENDIF --> /> {L_ACP_SIMPLEDOWN_PRIVATE}</label>
            </dd>
        </dl>
        <!-- Substituir arquivo -->
        <fieldset>
            <legend>{L_ACP_SIMPLEDOWN_REPLACE_FILE}</legend>
            <dl>
                <dt><label>{L_ACP_SIMPLEDOWN_REPLACE_FILE}:</label><br />
                    <span>{L_ACP_SIMPLEDOWN_REPLACE_FILE_EXPLAIN}</span>
                </dt>
                <dd>
                    <div class="custom-file-upload">
                        <input type="file" id="replace_upload" name="replace_upload" />
                        <label for="replace_upload" class="custom-file-label">
                            <span>{L_ACP_SIMPLEDOWN_CHOOSE_FILE}</span>
                        </label>
                        <span class="file-name-display" id="replace-file-name-display">{L_ACP_SIMPLEDOWN_NO_FILE_SELECTED}</span>
                    </div>
                    <!-- IF EDIT_FILE_REALNAME -->
                    <div style="margin-top: 12px;">
                        <strong>{L_ACP_SIMPLEDOWN_CURRENT_FILE}:</strong> {EDIT_FILE_REALNAME}
                    </div>
                    <!-- ENDIF -->
                </dd>
            </dl>
        </fieldset>
        <!-- Miniatura existente + Upload nova (mantido) -->
        <!-- ... (o resto do seu código original para thumbnails permanece igual) ... -->
        <p class="submit-buttons">
            <input class="button1" type="submit" name="submit_edit" value="{L_ACP_SIMPLEDOWN_SAVE_CHANGES}" />
            <a href="{U_ACTION}" class="button2">{L_ACP_SIMPLEDOWN_CANCEL}</a>
        </p>
    </fieldset>
    <!-- ENDIF -->
    <!-- ======================================== -->
    <!-- LISTAGEM DE ARQUIVOS -->
    <!-- ======================================== -->
    <fieldset>
        <legend>{L_ACP_SIMPLEDOWN_EXISTING_FILES}</legend>
        <div class="acp-controls-top">
            <div class="control-item total-item">
                {L_ACP_SIMPLEDOWN_TOTAL_FILES}: <strong>{TOTAL_FILES}</strong>
            </div>
        </div>
        <!-- IF .files -->
        <table class="table1 compact-table">
            <thead>
                <tr>
                    <th>{L_ACP_SIMPLEDOWN_FILE_NAME}</th>
                    <th>{L_ACP_SIMPLEDOWN_VERSION}</th>
                    <th>{L_ACP_SIMPLEDOWN_VISIBILITY}</th>
                    <th>{L_ACP_SIMPLEDOWN_CATEGORY}</th>
                    <th>{L_ACP_SIMPLEDOWN_DOWNLOADS} / {L_ACP_SIMPLEDOWN_SIZE}</th>
                    <th>{L_ACP_SIMPLEDOWN_ACTIONS}</th>
                </tr>
            </thead>
            <tbody>
                <!-- BEGIN files -->
                <tr>
                    <td>
                        <strong>{files.NAME}</strong><br />
                        <span class="desc-short">
                            {files.DESC_SHORT}
                            <!-- IF files.DESC_FORMATTED -->
                            <span class="view-full-desc"
                                  data-desc="{files.DESC_FORMATTED_ESCAPED}"
                                  title="{L_ACP_SIMPLEDOWN_VIEW_FULL_DESC}"
                                  aria-label="{L_ACP_SIMPLEDOWN_VIEW_FULL_DESC}">
                                <i class="fa-solid fa-eye fa-fw"></i>
                            </span>
                            <!-- ENDIF -->
                        </span><br />
                        <small><i class="icon fa-fw {files.FILE_ICON}"></i> {files.REAL_NAME}</small>
                    </td>
                    <td>{files.VERSION}</td>
                    <td style="text-align: center;">
                        <!-- IF files.IS_PRIVATE -->
                        <i class="fas fa-lock" style="color: #e74c3c;" title="{L_ACP_SIMPLEDOWN_PRIVATE}" aria-hidden="true"></i>
                        <span class="sr-only">{L_ACP_SIMPLEDOWN_PRIVATE}</span>
                        <!-- ELSE -->
                        <i class="fas fa-globe" style="color: #27ae60;" title="{L_ACP_SIMPLEDOWN_PUBLIC}" aria-hidden="true"></i>
                        <span class="sr-only">{L_ACP_SIMPLEDOWN_PUBLIC}</span>
                        <!-- ENDIF -->
                    </td>
                    <td>{files.CAT}</td>
                    <td>{files.DOWNLOADS}<br /><small>{files.SIZE}</small></td>
                    <td>
                        <a href="{files.U_EDIT}" class="button2">{L_ACP_SIMPLEDOWN_EDIT}</a>
                        <a href="{files.U_DELETE}" class="button2 danger">{L_ACP_SIMPLEDOWN_DELETE}</a>
                    </td>
                </tr>
                <!-- END files -->
            </tbody>
        </table>
        <!-- ELSE -->
        <p style="text-align:center; color:var(--text-light); font-style:italic;">{L_ACP_SIMPLEDOWN_NO_FILES_YET}</p>
        <!-- ENDIF -->
    </fieldset>
</form>
<!-- MODAIS e SCRIPT (mantidos iguais, com IDs corrigidos no toolbar de edição) -->
<!-- ... (o resto do seu código de modais e script permanece o mesmo, mas o script agora funciona com 'edit_file_desc' e 'color-picker-edit') ... -->
<!-- INCLUDECSS @mundophpbb_simpledown/acp_simpledown.css -->
<!-- INCLUDE overall_footer.html -->